# RNA-seq自动机器学习平台使用说明

## 项目概述

DiagnoML——实体肿瘤生物标志物和预测平台是一个专为RNA-seq数据分析设计的综合性工具，旨在帮助研究人员快速、高效地从RNA-seq数据中提取有价值的信息和构建预测模型。该平台基于Streamlit开发，提供了直观的用户界面和完整的分析流程。

## 功能特点

1. **用户友好**：简洁直观的界面设计，无需编程经验即可完成复杂分析
2. **全流程支持**：覆盖从数据预处理到模型构建的完整分析流程
3. **自动化建模**：内置自动特征选择和模型优化算法
4. **可视化分析**：丰富的可视化工具，帮助理解数据和解释结果
5. **可解释性**：提供模型可解释性分析，揭示基因与表型的关系

## 功能模块

### 数据处理
- **表达量校正**：TPM转换和z-score标准化
- **数据拆分**：训练集和测试集划分
- **数据预处理**：缺失值处理、编码转换、标准化
- **特征工程**：特征选择、降维、特征变换
- **数据平衡**：处理类别不平衡问题
- **统计匹配**：匹配样本特征，减少混杂因素影响

### 分析与建模
- **机器学习模型**：自定义建模和自动化建模
- **数据可视化**：探索性数据分析和结果可视化
- **可解释性分析**：特征重要性和SHAP值分析
- **模型验证**：性能评估和决策曲线分析
- **富集分析**：GO、KEGG通路和基因集富集分析

## 安装指南

### 系统要求
- Python 3.8或更高版本
- 足够的内存（建议至少8GB）
- 支持现代浏览器（Chrome、Firefox、Edge等）

### 安装步骤

1. **克隆或下载项目**

   ```bash
   git clone https://github.com/mrg223344/DiagnoML/DiagnoML.git
   cd rna_seq_app
   ```

2. **安装依赖包**

   ```bash
   pip install -r requirements.txt
   ```

   主要依赖包包括：
   - streamlit
   - pandas
   - numpy
   - scikit-learn
   - matplotlib
   - seaborn
   - plotly
   - shap

3. **运行应用**

   ```bash
   streamlit run app.py
   ```

   应用将在本地启动，并自动在默认浏览器中打开（通常是http://localhost:8501）。

## 使用指南

### 数据准备

平台支持CSV格式的RNA-seq数据。数据应包含以下内容：
- 基因表达量数据（列名以"GENE_"开头）
- 临床特征数据（如年龄、性别、疾病状态等）

如果没有现成的数据，平台提供了示例数据生成功能。

### 使用流程

1. **数据加载**
   - 在侧边栏选择"上传数据"或"生成示例数据"
   - 上传CSV格式的RNA-seq数据或设置参数生成示例数据

2. **数据预处理**
   - 表达量校正：将原始计数转换为TPM或进行z-score标准化
   - 数据拆分：将数据集划分为训练集和测试集
   - 数据预处理：处理缺失值、编码分类变量、标准化数值特征

3. **特征工程**
   - 特征选择：使用统计方法或机器学习方法选择重要特征
   - 降维：使用PCA或t-SNE减少特征维度
   - 特征变换：创建新特征或转换现有特征

4. **模型构建**
   - 自定义建模：选择算法、设置参数、训练模型
   - 自动化建模：自动执行特征选择和模型优化

5. **模型评估**
   - 性能指标：准确率、精确率、召回率、F1分数、AUC等
   - 可解释性分析：特征重要性、SHAP值、部分依赖图
   - 模型验证：ROC曲线、校准曲线、决策曲线分析

6. **结果解读**
   - 数据可视化：探索数据分布和关系
   - 富集分析：理解基因集的生物学功能和通路

### 各模块详细说明

#### 表达量校正
- 支持TPM（每百万转录本）转换
- 支持z-score标准化
- 可视化转换前后的表达分布

#### 数据拆分
- 支持随机拆分和分层拆分
- 可调整训练集和测试集比例
- 支持设置随机种子以确保可重复性

#### 数据预处理
- 缺失值处理：删除、均值/中位数填充、KNN填充
- 分类变量编码：One-hot编码、标签编码
- 数值变量标准化：Z-score、Min-Max、Robust

#### 特征工程
- 单变量特征选择：方差、相关性、统计检验
- 多变量特征选择：L1正则化、递归特征消除
- 特征重要性排序和可视化

#### 数据平衡
- 处理类别不平衡问题
- 支持过采样、欠采样和混合方法
- 可视化平衡前后的类别分布

#### 统计匹配
- 基于倾向得分的样本匹配
- 减少混杂因素的影响
- 匹配前后的分布比较

#### 机器学习模型
- 支持多种分类算法：逻辑回归、随机森林、SVM等
- 自定义模式：手动选择特征和设置参数
- 自动化模式：自动执行特征选择和参数优化

#### 数据可视化
- 基本统计可视化：分类变量分布、数值变量分布
- 相关性分析：热图、散点图矩阵
- 降维可视化：PCA、t-SNE
- 表达模式可视化：热图、聚类热图
- 交互式可视化：使用Plotly创建交互式图表

#### 可解释性分析
- 特征重要性：模型内置重要性、排列重要性
- SHAP值分析：摘要图、依赖图、力图
- 部分依赖图：展示特征值变化对预测的影响

#### 模型验证
- ROC曲线分析：评估模型的区分能力
- 校准曲线：评估预测概率的准确性
- 决策曲线分析：评估模型在特定阈值下的临床净收益
- 外部验证：使用独立数据集验证模型性能

#### 富集分析
- GO富集分析：基因本体论富集分析
- KEGG通路富集分析：通路富集和可视化
- 基因集富集分析(GSEA)：评估基因集在排序列表中的富集程度

## 示例数据

平台内置了示例数据生成功能，可以生成模拟的RNA-seq数据用于测试和学习。生成的数据包括：
- 基因表达数据（模拟RNA-seq计数）
- 临床特征（年龄、性别、疾病状态等）
- 人为设置的基因-表型关联

## 常见问题

1. **应用启动失败**
   - 检查是否安装了所有依赖包
   - 确认Python版本是否兼容（3.8+）
   - 检查端口8501是否被占用

2. **数据上传问题**
   - 确保数据为CSV格式
   - 检查文件大小（Streamlit默认限制为200MB）
   - 确保基因列名以"GENE_"开头

3. **模型训练缓慢**
   - 减少特征数量
   - 使用较小的数据集进行测试
   - 选择计算效率更高的算法

4. **可视化不显示**
   - 刷新浏览器
   - 检查数据格式是否正确
   - 确认是否有足够的内存

## 联系与支持

如有问题或建议，请通过以下方式联系我们：
- 提交GitHub Issues
- 发送邮件至：mengruogang@163.com

## 许可证

本项目采用MIT许可证。详情请参阅LICENSE文件。

---

感谢您使用DiagnoML——实体肿瘤生物标志物和预测平台！我们希望这个工具能够帮助您更高效地分析RNA-seq数据并获得有价值的见解。
